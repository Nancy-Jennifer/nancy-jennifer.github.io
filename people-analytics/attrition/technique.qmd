---
title: "Notebook technique ‚Äì IBM HR Attrition"
subtitle: "Pr√©paration des donn√©es, pipeline analytique et g√©n√©ration des figures EDA (H1 √† H6)"
format:
  html:
    toc: true
    toc-depth: 3
    number-sections: true
    code-fold: true
execute:
  echo: true
  warning: false
  message: false
---

::: {.callout-note}
Ce notebook documente la **cha√Æne technique compl√®te de pr√©paration des donn√©es et de g√©n√©ration des visualisations EDA en Python**.  

Il constitue le support de reproductibilit√© de l‚Äôanalyse.  
Pour la lecture m√©tier et les recommandations RH, se r√©f√©rer aux pages d‚Äôinterpr√©tation du projet.
:::

## Objectif technique du notebook

Ce document reprend la logique du pipeline Python utilis√© pour l‚Äôanalyse :

- importation et pr√©paration du dataset **IBM HR Attrition**,  
- harmonisation des variables pour la lecture analytique,  
- g√©n√©ration des visualisations associ√©es aux **six hypoth√®ses People Analytics**,  
- **export syst√©matique des figures en PNG** dans `assets/people-analytics/figures/` pour int√©gration dans `eda_resultats.qmd`.

Ce notebook se concentre exclusivement sur les **choix techniques, la structuration des donn√©es et la reproductibilit√©**.

## Import des biblioth√®ques & configuration

```{python}
import os
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

plt.style.use("default")
plt.rcParams["figure.figsize"] = (8, 5)

def find_repo_root(start_dir: str) -> str:
    """
    Remonte l'arborescence √† partir de start_dir pour trouver la racine du projet
    (rep√©r√©e par la pr√©sence de _quarto.yml). Retourne start_dir si non trouv√©.
    """
    current = os.path.abspath(start_dir)
    while True:
        if os.path.exists(os.path.join(current, "_quarto.yml")):
            return current
        parent = os.path.dirname(current)
        if parent == current:
            return os.path.abspath(start_dir)
        current = parent

REPO_ROOT = find_repo_root(os.getcwd())

DATA_PATH = os.path.join(
    REPO_ROOT, "people-analytics", "data", "WA_Fn-UseC_-HR-Employee-Attrition.csv"
)

OUTPUT_DIR = os.path.join(
    REPO_ROOT, "assets", "people-analytics", "figures"
)
os.makedirs(OUTPUT_DIR, exist_ok=True)

print("REPO_ROOT :", REPO_ROOT)
print("DATA_PATH :", DATA_PATH)
print("OUTPUT_DIR:", OUTPUT_DIR)
print("CSV existe ?", os.path.exists(DATA_PATH))
```

## Chargement du jeu de donn√©es

```{python}
if not os.path.exists(DATA_PATH):
    raise FileNotFoundError(
        "CSV introuvable au chemin attendu.\n"
        f"Chemin test√© : {DATA_PATH}\n"
        "üëâ V√©rifie qu'il est bien versionn√© dans le repo (people-analytics/data/) "
        "et relance le rendu."
    )

df = pd.read_csv(DATA_PATH)
df.head()
```

## Harmonisation des variables

```{python}
colonnes_renommees = {
    "Attrition": "D√©part",
    "BusinessTravel": "D√©placements professionnels",
    "Age": "√Çge",
    "Department": "D√©partement",
    "MonthlyIncome": "Salaire mensuel",
    "EducationField": "Domaine d‚Äô√©tudes",
    "TotalWorkingYears": "Ann√©es de carri√®re",
    "Gender": "Sexe",
    "YearsAtCompany": "Anciennet√© dans l‚Äôentreprise",
    "JobRole": "Poste",
    "JobSatisfaction": "Satisfaction au travail",
    "MaritalStatus": "√âtat civil",
    "EnvironmentSatisfaction": "Satisfaction environnement",
    "OverTime": "Heures suppl√©mentaires",
    "WorkLifeBalance": "√âquilibre vie pro/perso",
    "DistanceFromHome": "Distance domicile-travail",
}

df = df.rename(columns=colonnes_renommees)

required_cols = [
    "D√©part",
    "Satisfaction au travail",
    "Anciennet√© dans l‚Äôentreprise",
    "Distance domicile-travail",
    "Heures suppl√©mentaires",
    "Poste",
]
missing = [c for c in required_cols if c not in df.columns]
if missing:
    raise ValueError(f"Colonnes manquantes apr√®s renommage: {missing}")

print("‚úÖ Colonnes critiques OK.")
```

## V√©rifications rapides (types & distribution)

```{python}
df.info()
```

```{python}
df["D√©part"].value_counts()
```

---

## G√©n√©ration des figures pour l‚ÄôEDA (H1 √† H6)

Chaque sous-section :

1. produit la visualisation,  
2. l‚Äôaffiche dans le rendu,  
3. l‚Äôenregistre automatiquement dans le dossier projet.

### H1 ‚Äì Satisfaction au travail √ó D√©part

```{python}
table_h1 = pd.crosstab(
    df["Satisfaction au travail"],
    df["D√©part"],
    normalize="index"
)
table_h1
```

```{python}
fig, ax = plt.subplots()

bottom = np.zeros(len(table_h1))
x = np.arange(len(table_h1.index))

for status in table_h1.columns:
    ax.bar(x, table_h1[status].values, bottom=bottom, label=status)
    bottom += table_h1[status].values

ax.set_title("R√©partition des d√©parts selon la satisfaction au travail")
ax.set_xlabel("Satisfaction au travail (1 = tr√®s faible, 4 = tr√®s √©lev√©e)")
ax.set_ylabel("Proportion d'employ√©s")
ax.set_xticks(x)
ax.set_xticklabels(table_h1.index)
ax.legend(title="D√©part")
ax.grid(axis="y", alpha=0.3)

fig_path_h1 = os.path.join(OUTPUT_DIR, "H1_satisfaction_depart.png")
fig.savefig(fig_path_h1, dpi=300, bbox_inches="tight")
plt.show()
plt.close(fig)

print("‚úÖ Figure H1 sauvegard√©e :", fig_path_h1)
```

## R√©capitulatif des figures g√©n√©r√©es

```{python}
files = sorted(f for f in os.listdir(OUTPUT_DIR) if f.lower().endswith(".png"))
files
```

---

**üîó Navigation du projet**

- üìä [Voir les R√©sultats de l‚ÄôAnalyse Exploratoire (EDA)](eda_resultats.qmd)
- üìå [Voir la Synth√®se & Recommandations RH](synthese_reco.qmd)
- üè†[Retour √† la page d‚Äôaccueil du projet](../attrition/index.qmd)
