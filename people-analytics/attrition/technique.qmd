---
title: "Notebook technique â€“ IBM HR Attrition"
subtitle: "PrÃ©paration des donnÃ©es & gÃ©nÃ©ration des figures EDA (H1 Ã  H6)"
format:
  html:
    toc: true
    toc-depth: 3
    number-sections: true
    code-fold: true
execute:
  echo: true
  warning: false
  message: false
---

## 1. Contexte & objectif technique

Ce document reprend la logique de ton notebook Python initial :

- importation & prÃ©paration du dataset **IBM HR Attrition**,
- renommage des variables en franÃ§ais,
- gÃ©nÃ©ration des figures correspondant aux **6 hypothÃ¨ses People Analytics**,
- **sauvegarde systÃ©matique en PNG** dans `assets/people-analytics/figures/` pour intÃ©gration dans `eda_resultats.qmd`.

Aucune interprÃ©tation mÃ©tier nâ€™est donnÃ©e ici : on se concentre uniquement sur les **dÃ©cisions techniques**.

## 2. Import des bibliothÃ¨ques & configuration

```{python}
import os
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# Style de base pour les graphiques
plt.style.use("default")
plt.rcParams["figure.figsize"] = (8, 5)

# Dossier de sortie des figures pour le portfolio
OUTPUT_DIR = "assets/people-analytics/figures"
os.makedirs(OUTPUT_DIR, exist_ok=True)

print(f"Dossier de sortie des figures : {os.path.abspath(OUTPUT_DIR)}")
```

## 3. Chargement du jeu de donnÃ©es

```{python}
# Tentative 1 : dataset dans un sous-dossier data/
candidate_paths = [
    "data/WA_Fn-UseC_-HR-Employee-Attrition.csv",
    "people-analytics/data/WA_Fn-UseC_-HR-Employee-Attrition.csv",
    "WA_Fn-UseC_-HR-Employee-Attrition.csv",
]

data_path = None
for path in candidate_paths:
    if os.path.exists(path):
        data_path = path
        break

if data_path is None:
    raise FileNotFoundError(
        "Le fichier 'WA_Fn-UseC_-HR-Employee-Attrition.csv' est introuvable.\n"
        "â†’ VÃ©rifie son emplacement dans ton repo et adapte 'candidate_paths' ci-dessus."
    )

df = pd.read_csv(data_path)
df.head()
```

## 4. Renommage des variables (version franÃ§aise)

On applique le renommage cohÃ©rent avec ton projet People Analytics.

```{python}
colonnes_renommees = {
    "Attrition": "DÃ©part",  # Variable cible
    "BusinessTravel": "DÃ©placements professionnels",
    "Age": "Ã‚ge",
    "Department": "DÃ©partement",
    "MonthlyIncome": "Salaire mensuel",
    "EducationField": "Domaine dâ€™Ã©tudes",
    "TotalWorkingYears": "AnnÃ©es de carriÃ¨re",
    "Gender": "Sexe",
    "YearsAtCompany": "AnciennetÃ© dans lâ€™entreprise",
    "JobRole": "Poste",
    "JobSatisfaction": "Satisfaction au travail",
    "MaritalStatus": "Ã‰tat civil",
    "EnvironmentSatisfaction": "Satisfaction environnement",
    "OverTime": "Heures supplÃ©mentaires",
    "WorkLifeBalance": "Ã‰quilibre vie pro/perso",
    "DistanceFromHome": "Distance domicile-travail",  # ðŸ”§ cohÃ©rence H3
}

df = df.rename(columns=colonnes_renommees)

# VÃ©rification rapide
sorted([c for c in df.columns if c in colonnes_renommees.values()])
```

## 5. VÃ©rifications rapides (type & valeurs)

```{python}
df.info()
```

```{python}
df.describe().T
```

```{python}
df.describe(include="object").T
```

```{python}
df["DÃ©part"].value_counts()
```

---

## 6. Figures pour lâ€™EDA (H1 Ã  H6)

Chaque sous-section gÃ©nÃ¨re **un graphique clÃ©** et lâ€™enregistre en PNG dans  
`assets/people-analytics/figures/`.

---

### 6.1 H1 â€“ Satisfaction au travail Ã— DÃ©part

> HypothÃ¨se 1 : les employÃ©s les moins satisfaits quittent davantage lâ€™entreprise.

Tableau croisÃ© normalisÃ© + barres empilÃ©es.

```{python}
# Tableau croisÃ© (proportions par niveau de satisfaction)
table_h1 = pd.crosstab(
    df["Satisfaction au travail"],
    df["DÃ©part"],
    normalize="index"
)

table_h1
```

```{python}
# Graphique H1 â€“ barres empilÃ©es
fig, ax = plt.subplots()

bottom = np.zeros(len(table_h1))
x = np.arange(len(table_h1.index))

for status in table_h1.columns:
    ax.bar(
        x,
        table_h1[status].values,
        bottom=bottom,
        label=status
    )
    bottom += table_h1[status].values

ax.set_title("RÃ©partition des dÃ©parts selon la satisfaction au travail")
ax.set_xlabel("Satisfaction au travail (1 = trÃ¨s faible, 4 = trÃ¨s Ã©levÃ©e)")
ax.set_ylabel("Proportion d'employÃ©s")
ax.set_xticks(x)
ax.set_xticklabels(table_h1.index)
ax.legend(title="DÃ©part")
ax.grid(axis="y", alpha=0.3)

# Sauvegarde PNG
fig_path_h1 = os.path.join(OUTPUT_DIR, "H1_satisfaction_depart.png")
fig.savefig(fig_path_h1, bbox_inches="tight")
plt.show()

print("Figure H1 sauvegardÃ©e dans :", fig_path_h1)
```

---

### 6.2 H2 â€“ AnciennetÃ© dans lâ€™entreprise Ã— DÃ©part

> HypothÃ¨se 2 : les employÃ©s les plus rÃ©cents partent davantage.

Boxplot par statut de dÃ©part (ancienne version seaborn â†’ matplotlib pur).

```{python}
# DonnÃ©es pour le boxplot
col_anciennete = "AnciennetÃ© dans lâ€™entreprise"
categories_depart = df["DÃ©part"].unique()

data_h2 = [df.loc[df["DÃ©part"] == cat, col_anciennete].dropna()
           for cat in categories_depart]

fig, ax = plt.subplots()

ax.boxplot(
    data_h2,
    labels=categories_depart,
    showfliers=True
)

ax.set_title("AnciennetÃ© dans lâ€™entreprise selon le statut de dÃ©part")
ax.set_xlabel("DÃ©part de l'entreprise")
ax.set_ylabel("AnciennetÃ© dans lâ€™entreprise (en annÃ©es)")
ax.grid(axis="y", alpha=0.3)

fig_path_h2 = os.path.join(OUTPUT_DIR, "H2_anciennete_depart.png")
fig.savefig(fig_path_h2, bbox_inches="tight")
plt.show()

print("Figure H2 sauvegardÃ©e dans :", fig_path_h2)
```

---

### 6.3 H3 â€“ Distance domicile-travail Ã— DÃ©part

> HypothÃ¨se 3 : plus la distance est grande, plus les salariÃ©s quittent lâ€™entreprise.

Histogrammes groupÃ©s par statut de dÃ©part (remplacement de `sns.histplot`).

```{python}
col_distance = "Distance domicile-travail"

fig, ax = plt.subplots()

bins = 20
for status, subset in df.groupby("DÃ©part"):
    ax.hist(
        subset[col_distance].dropna(),
        bins=bins,
        alpha=0.5,
        label=status
    )

ax.set_title("Distribution de la distance domicile-travail selon le dÃ©part")
ax.set_xlabel("Distance domicile-travail (en km)")
ax.set_ylabel("Nombre dâ€™employÃ©s")
ax.legend(title="DÃ©part")
ax.grid(axis="y", alpha=0.3)

fig_path_h3 = os.path.join(OUTPUT_DIR, "H3_distance_depart.png")
fig.savefig(fig_path_h3, bbox_inches="tight")
plt.show()

print("Figure H3 sauvegardÃ©e dans :", fig_path_h3)
```

---

### 6.4 H4 â€“ Heures supplÃ©mentaires Ã— DÃ©part

> HypothÃ¨se 4 : les salariÃ©s faisant des heures supplÃ©mentaires quittent davantage lâ€™entreprise.

Tableau croisÃ© normalisÃ© + barres empilÃ©es.

```{python}
table_h4 = pd.crosstab(
    df["Heures supplÃ©mentaires"],
    df["DÃ©part"],
    normalize="index"
)

table_h4
```

```{python}
fig, ax = plt.subplots()

bottom = np.zeros(len(table_h4))
x = np.arange(len(table_h4.index))

for status in table_h4.columns:
    ax.bar(
        x,
        table_h4[status].values,
        bottom=bottom,
        label=status
    )
    bottom += table_h4[status].values

ax.set_title("RÃ©partition des dÃ©parts selon les heures supplÃ©mentaires")
ax.set_xlabel("Heures supplÃ©mentaires")
ax.set_ylabel("Proportion dâ€™employÃ©s")
ax.set_xticks(x)
ax.set_xticklabels(table_h4.index)
ax.legend(title="DÃ©part")
ax.grid(axis="y", alpha=0.3)

fig_path_h4 = os.path.join(OUTPUT_DIR, "H4_heures_sup_depart.png")
fig.savefig(fig_path_h4, bbox_inches="tight")
plt.show()

print("Figure H4 sauvegardÃ©e dans :", fig_path_h4)
```

---

### 6.5 H5 â€“ AnciennetÃ© Ã— Heures supplÃ©mentaires Ã— DÃ©part

> HypothÃ¨se 5 : lâ€™entreprise affecte davantage les heures supplÃ©mentaires aux salariÃ©s rÃ©cents, ce qui pourrait contribuer Ã  leur dÃ©part.

On produit **deux vues** (trÃ¨s techniques) :

1. Boxplot anciennetÃ© Ã— heures sup Ã— dÃ©part (remplacement de `sns.boxplot`),
2. Barres empilÃ©es des heures sup par **tranches dâ€™anciennetÃ©**.

#### 6.5.1 Boxplot anciennetÃ© Ã— heures sup Ã— dÃ©part

```{python}
fig, ax = plt.subplots()

categories_heure = df["Heures supplÃ©mentaires"].unique()
positions = np.arange(len(categories_heure))
width = 0.35

for i, dep_status in enumerate(df["DÃ©part"].unique()):
    data = [
        df[(df["Heures supplÃ©mentaires"] == h) & (df["DÃ©part"] == dep_status)][col_anciennete].dropna()
        for h in categories_heure
    ]

    # On dÃ©cale les boxplots pour sÃ©parer les catÃ©gories de dÃ©part
    box_positions = positions + (i - 0.5) * width
    bp = ax.boxplot(
        data,
        positions=box_positions,
        widths=width,
        patch_artist=True
    )

ax.set_xticks(positions)
ax.set_xticklabels(categories_heure)
ax.set_xlabel("Heures supplÃ©mentaires")
ax.set_ylabel("AnciennetÃ© dans lâ€™entreprise (en annÃ©es)")
ax.set_title("AnciennetÃ© selon les heures supplÃ©mentaires et le statut de dÃ©part")
ax.grid(axis="y", alpha=0.3)

fig_path_h5_box = os.path.join(OUTPUT_DIR, "H5_anciennete_heures_sup_boxplot.png")
fig.savefig(fig_path_h5_box, bbox_inches="tight")
plt.show()

print("Figure H5 (boxplot) sauvegardÃ©e dans :", fig_path_h5_box)
```

#### 6.5.2 Heures sup par tranches dâ€™anciennetÃ©

```{python}
# Construction de la variable "Tranche anciennetÃ©"
max_anc = df[col_anciennete].max()
bins = [0, 3, 6, 10, max_anc]
labels = ["0-3 ans", "4-6 ans", "7-10 ans", "10+ ans"]

df["Tranche anciennetÃ©"] = pd.cut(df[col_anciennete], bins=bins, labels=labels, include_lowest=True)

table_h5 = pd.crosstab(
    df["Tranche anciennetÃ©"],
    df["Heures supplÃ©mentaires"],
    normalize="index"
) * 100

table_h5.round(1)
```

```{python}
fig, ax = plt.subplots()

bottom = np.zeros(len(table_h5))
x = np.arange(len(table_h5.index))

for hsup in table_h5.columns:
    ax.bar(
        x,
        table_h5[hsup].values,
        bottom=bottom,
        label=hsup
    )
    bottom += table_h5[hsup].values

ax.set_title("RÃ©partition des heures supplÃ©mentaires par tranche dâ€™anciennetÃ©")
ax.set_xlabel("Tranche dâ€™anciennetÃ©")
ax.set_ylabel("Proportion dâ€™employÃ©s (%)")
ax.set_xticks(x)
ax.set_xticklabels(table_h5.index)
ax.legend(title="Heures supplÃ©mentaires")
ax.grid(axis="y", alpha=0.3)

fig_path_h5 = os.path.join(OUTPUT_DIR, "H5_anciennete_heures_sup.png")
fig.savefig(fig_path_h5, bbox_inches="tight")
plt.show()

print("Figure H5 (tranches) sauvegardÃ©e dans :", fig_path_h5)
```

> Pour ton `eda_resultats.qmd`, tu pourras choisir soit le **boxplot**, soit le **graphique par tranches** comme visuel principal de H5.

---

### 6.6 H6 â€“ Poste Ã— DÃ©part (zones mÃ©tier Ã  risque)

> HypothÃ¨se 6 : certains postes prÃ©sentent des taux de dÃ©part plus Ã©levÃ©s que dâ€™autres.

#### 6.6.1 Barres empilÃ©es par poste

```{python}
table_h6_bar = pd.crosstab(
    df["Poste"],
    df["DÃ©part"],
    normalize="index"
)

table_h6_bar.head()
```

```{python}
fig, ax = plt.subplots(figsize=(10, 6))

bottom = np.zeros(len(table_h6_bar))
x = np.arange(len(table_h6_bar.index))

for status in table_h6_bar.columns:
    ax.bar(
        x,
        table_h6_bar[status].values,
        bottom=bottom,
        label=status
    )
    bottom += table_h6_bar[status].values

ax.set_title("Taux de dÃ©part par poste (barres empilÃ©es)")
ax.set_xlabel("Poste")
ax.set_ylabel("Proportion d'employÃ©s")
ax.set_xticks(x)
ax.set_xticklabels(table_h6_bar.index, rotation=45, ha="right")
ax.legend(title="DÃ©part")
ax.grid(axis="y", alpha=0.3)

fig_path_h6_bar = os.path.join(OUTPUT_DIR, "H6_poste_depart_barres.png")
fig.savefig(fig_path_h6_bar, bbox_inches="tight")
plt.show()

print("Figure H6 (barres) sauvegardÃ©e dans :", fig_path_h6_bar)
```

#### 6.6.2 Heatmap poste Ã— dÃ©part (remplacement de `sns.heatmap`)

```{python}
# Tableau croisÃ© normalisÃ© pour la heatmap
heatmap_data = pd.crosstab(
    df["Poste"],
    df["DÃ©part"],
    normalize="index"
)

heatmap_data.round(2)
```

```{python}
fig, ax = plt.subplots(figsize=(10, 6))

im = ax.imshow(heatmap_data.values, aspect="auto")

# Axes
ax.set_xticks(np.arange(len(heatmap_data.columns)))
ax.set_yticks(np.arange(len(heatmap_data.index)))

ax.set_xticklabels(heatmap_data.columns)
ax.set_yticklabels(heatmap_data.index)

plt.setp(ax.get_xticklabels(), rotation=0)
plt.setp(ax.get_yticklabels(), rotation=45, ha="right")

ax.set_title("Taux de dÃ©part par poste (heatmap)")
ax.set_xlabel("DÃ©part")
ax.set_ylabel("Poste")

# Annotation des cellules
for i in range(heatmap_data.shape[0]):
    for j in range(heatmap_data.shape[1]):
        value = heatmap_data.values[i, j]
        ax.text(
            j,
            i,
            f"{value:.2f}",
            ha="center",
            va="center",
            color="white" if value > 0.5 else "black",
            fontsize=8
        )

fig.colorbar(im, ax=ax, fraction=0.046, pad=0.04)

fig_path_h6 = os.path.join(OUTPUT_DIR, "H6_poste_depart_heatmap.png")
fig.savefig(fig_path_h6, bbox_inches="tight")
plt.show()

print("Figure H6 (heatmap) sauvegardÃ©e dans :", fig_path_h6)
```

---

## 7. RÃ©capitulatif des figures gÃ©nÃ©rÃ©es

```{python}
sorted(f for f in os.listdir(OUTPUT_DIR) if f.lower().endswith(".png"))
```

> Tu peux maintenant **rÃ©utiliser ces PNG** dans `eda_resultats.qmd` via :
>
> ```markdown
> ![](../assets/people-analytics/figures/H1_satisfaction_depart.png)
> ```
>
> (en adaptant le chemin relatif selon lâ€™emplacement de ta page).
