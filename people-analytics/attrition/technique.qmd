---
title: "Notebook technique â€“ IBM HR Attrition"
subtitle: "PrÃ©paration des donnÃ©es & gÃ©nÃ©ration des figures EDA (H1 Ã  H6)"
format:
  html:
    toc: true
    toc-depth: 3
    number-sections: true
    code-fold: true
execute:
  echo: true
  warning: false
  message: false
---

::: {.callout-note}
ğŸ” Ce notebook documente la **prÃ©paration des donnÃ©es et lâ€™EDA en Python**.  
Pour lâ€™interprÃ©tation mÃ©tier et les dÃ©cisions RH, consulter les pages ci-dessous.
:::

## Contexte & objectif technique

Ce document reprend la logique du notebook Python initial :

- importation & prÃ©paration du dataset **IBM HR Attrition**,
- renommage des variables en franÃ§ais,
- gÃ©nÃ©ration des figures correspondant aux **6 hypothÃ¨ses People Analytics**,
- **sauvegarde systÃ©matique en PNG** dans `assets/people-analytics/figures/` pour intÃ©gration dans `eda_resultats.qmd`.

Aucune interprÃ©tation mÃ©tier nâ€™est donnÃ©e ici : on se concentre uniquement sur les **dÃ©cisions techniques**.

## Import des bibliothÃ¨ques & configuration

```{python}
import os
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

plt.style.use("default")
plt.rcParams["figure.figsize"] = (8, 5)

def find_repo_root(start_dir: str) -> str:
    """
    Remonte l'arborescence Ã  partir de start_dir pour trouver la racine du projet
    (repÃ©rÃ©e par la prÃ©sence de _quarto.yml). Retourne start_dir si non trouvÃ©.
    """
    current = os.path.abspath(start_dir)
    while True:
        if os.path.exists(os.path.join(current, "_quarto.yml")):
            return current
        parent = os.path.dirname(current)
        if parent == current:
            return os.path.abspath(start_dir)
        current = parent

REPO_ROOT = find_repo_root(os.getcwd())

DATA_PATH = os.path.join(
    REPO_ROOT, "people-analytics", "data", "WA_Fn-UseC_-HR-Employee-Attrition.csv"
)

OUTPUT_DIR = os.path.join(
    REPO_ROOT, "assets", "people-analytics", "figures"
)
os.makedirs(OUTPUT_DIR, exist_ok=True)

print("REPO_ROOT :", REPO_ROOT)
print("DATA_PATH :", DATA_PATH)
print("OUTPUT_DIR:", OUTPUT_DIR)
print("CSV existe ?", os.path.exists(DATA_PATH))
```

## Chargement du jeu de donnÃ©es

```{python}
if not os.path.exists(DATA_PATH):
    raise FileNotFoundError(
        "CSV introuvable au chemin attendu.\n"
        f"Chemin testÃ© : {DATA_PATH}\n"
        "ğŸ‘‰ VÃ©rifie qu'il est bien versionnÃ© dans le repo (people-analytics/data/) "
        "et relance le rendu."
    )

df = pd.read_csv(DATA_PATH)
df.head()
```

## Renommage des variables (version franÃ§aise)

```{python}
colonnes_renommees = {
    "Attrition": "DÃ©part",
    "BusinessTravel": "DÃ©placements professionnels",
    "Age": "Ã‚ge",
    "Department": "DÃ©partement",
    "MonthlyIncome": "Salaire mensuel",
    "EducationField": "Domaine dâ€™Ã©tudes",
    "TotalWorkingYears": "AnnÃ©es de carriÃ¨re",
    "Gender": "Sexe",
    "YearsAtCompany": "AnciennetÃ© dans lâ€™entreprise",
    "JobRole": "Poste",
    "JobSatisfaction": "Satisfaction au travail",
    "MaritalStatus": "Ã‰tat civil",
    "EnvironmentSatisfaction": "Satisfaction environnement",
    "OverTime": "Heures supplÃ©mentaires",
    "WorkLifeBalance": "Ã‰quilibre vie pro/perso",
    "DistanceFromHome": "Distance domicile-travail",
}

df = df.rename(columns=colonnes_renommees)

# garde-fou: on vÃ©rifie que les colonnes critiques existent bien
required_cols = [
    "DÃ©part",
    "Satisfaction au travail",
    "AnciennetÃ© dans lâ€™entreprise",
    "Distance domicile-travail",
    "Heures supplÃ©mentaires",
    "Poste",
]
missing = [c for c in required_cols if c not in df.columns]
if missing:
    raise ValueError(f"Colonnes manquantes aprÃ¨s renommage: {missing}")

print("âœ… Colonnes critiques OK.")
```

## VÃ©rifications rapides (types & valeurs)

```{python}
df.info()
```

```{python}
df["DÃ©part"].value_counts()
```

---

## Figures pour lâ€™EDA (H1 Ã  H6)

Chaque sous-section :
1) gÃ©nÃ¨re un graphique clÃ©,
2) lâ€™affiche dans le rendu,
3) et lâ€™enregistre en PNG dans `assets/people-analytics/figures/`.

### H1 â€“ Satisfaction au travail Ã— DÃ©part

```{python}
table_h1 = pd.crosstab(
    df["Satisfaction au travail"],
    df["DÃ©part"],
    normalize="index"
)
table_h1
```

```{python}
fig, ax = plt.subplots()

bottom = np.zeros(len(table_h1))
x = np.arange(len(table_h1.index))

for status in table_h1.columns:
    ax.bar(x, table_h1[status].values, bottom=bottom, label=status)
    bottom += table_h1[status].values

ax.set_title("RÃ©partition des dÃ©parts selon la satisfaction au travail")
ax.set_xlabel("Satisfaction au travail (1 = trÃ¨s faible, 4 = trÃ¨s Ã©levÃ©e)")
ax.set_ylabel("Proportion d'employÃ©s")
ax.set_xticks(x)
ax.set_xticklabels(table_h1.index)
ax.legend(title="DÃ©part")
ax.grid(axis="y", alpha=0.3)

fig_path_h1 = os.path.join(OUTPUT_DIR, "H1_satisfaction_depart.png")
fig.savefig(fig_path_h1, dpi=300, bbox_inches="tight")
plt.show()
plt.close(fig)

print("âœ… Figure H1 sauvegardÃ©e :", fig_path_h1)
```

### H2 â€“ AnciennetÃ© dans lâ€™entreprise Ã— DÃ©part

```{python}
col_anciennete = "AnciennetÃ© dans lâ€™entreprise"

# Ordre stable (pour Ã©viter que Yes/No change selon l'environnement)
order_depart = ["Yes", "No"]
present = [c for c in order_depart if c in df["DÃ©part"].unique()]
if len(present) != len(order_depart):
    present = list(df["DÃ©part"].unique())

data_h2 = [df.loc[df["DÃ©part"] == cat, col_anciennete].dropna() for cat in present]

fig, ax = plt.subplots()
ax.boxplot(data_h2, labels=present, showfliers=True)

ax.set_title("AnciennetÃ© dans lâ€™entreprise selon le statut de dÃ©part")
ax.set_xlabel("DÃ©part de l'entreprise")
ax.set_ylabel("AnciennetÃ© dans lâ€™entreprise (en annÃ©es)")
ax.grid(axis="y", alpha=0.3)

fig_path_h2 = os.path.join(OUTPUT_DIR, "H2_anciennete_depart.png")
fig.savefig(fig_path_h2, dpi=300, bbox_inches="tight")
plt.show()
plt.close(fig)

print("âœ… Figure H2 sauvegardÃ©e :", fig_path_h2)
```

### H3 â€“ Distance domicile-travail Ã— DÃ©part

```{python}
col_distance = "Distance domicile-travail"

fig, ax = plt.subplots()

bins = 20
for status, subset in df.groupby("DÃ©part"):
    ax.hist(subset[col_distance].dropna(), bins=bins, alpha=0.5, label=status)

ax.set_title("Distribution de la distance domicile-travail selon le dÃ©part")
ax.set_xlabel("Distance domicile-travail")
ax.set_ylabel("Nombre dâ€™employÃ©s")
ax.legend(title="DÃ©part")
ax.grid(axis="y", alpha=0.3)

fig_path_h3 = os.path.join(OUTPUT_DIR, "H3_distance_depart.png")
fig.savefig(fig_path_h3, dpi=300, bbox_inches="tight")
plt.show()
plt.close(fig)

print("âœ… Figure H3 sauvegardÃ©e :", fig_path_h3)
```

### H4 â€“ Heures supplÃ©mentaires Ã— DÃ©part

```{python}
table_h4 = pd.crosstab(
    df["Heures supplÃ©mentaires"],
    df["DÃ©part"],
    normalize="index"
)
table_h4
```

```{python}
fig, ax = plt.subplots()

bottom = np.zeros(len(table_h4))
x = np.arange(len(table_h4.index))

for status in table_h4.columns:
    ax.bar(x, table_h4[status].values, bottom=bottom, label=status)
    bottom += table_h4[status].values

ax.set_title("RÃ©partition des dÃ©parts selon les heures supplÃ©mentaires")
ax.set_xlabel("Heures supplÃ©mentaires")
ax.set_ylabel("Proportion d'employÃ©s")
ax.set_xticks(x)
ax.set_xticklabels(table_h4.index)
ax.legend(title="DÃ©part")
ax.grid(axis="y", alpha=0.3)

fig_path_h4 = os.path.join(OUTPUT_DIR, "H4_heures_sup_depart.png")
fig.savefig(fig_path_h4, dpi=300, bbox_inches="tight")
plt.show()
plt.close(fig)

print("âœ… Figure H4 sauvegardÃ©e :", fig_path_h4)
```

### H5 â€“ AnciennetÃ© Ã— Heures supplÃ©mentaires

```{python}
max_anc = df[col_anciennete].max()

# garde-fou si valeurs Ã©tranges
max_anc = 40 if pd.isna(max_anc) else float(max_anc)
bins = [0, 3, 6, 10, max_anc]
labels = ["0-3 ans", "4-6 ans", "7-10 ans", "10+ ans"]

df["Tranche anciennetÃ©"] = pd.cut(
    df[col_anciennete],
    bins=bins,
    labels=labels,
    include_lowest=True
)

table_h5 = pd.crosstab(
    df["Tranche anciennetÃ©"],
    df["Heures supplÃ©mentaires"],
    normalize="index"
) * 100

table_h5.round(1)
```

```{python}
fig, ax = plt.subplots()

bottom = np.zeros(len(table_h5))
x = np.arange(len(table_h5.index))

for hsup in table_h5.columns:
    ax.bar(x, table_h5[hsup].values, bottom=bottom, label=hsup)
    bottom += table_h5[hsup].values

ax.set_title("RÃ©partition des heures supplÃ©mentaires par tranche dâ€™anciennetÃ©")
ax.set_xlabel("Tranche dâ€™anciennetÃ©")
ax.set_ylabel("Proportion dâ€™employÃ©s (%)")
ax.set_xticks(x)
ax.set_xticklabels(table_h5.index)
ax.legend(title="Heures supplÃ©mentaires")
ax.grid(axis="y", alpha=0.3)

fig_path_h5 = os.path.join(OUTPUT_DIR, "H5_anciennete_heures_sup.png")
fig.savefig(fig_path_h5, dpi=300, bbox_inches="tight")
plt.show()
plt.close(fig)

print("âœ… Figure H5 sauvegardÃ©e :", fig_path_h5)
```

### H6 â€“ Poste Ã— DÃ©part (zones mÃ©tier Ã  risque)

```{python}
table_h6 = pd.crosstab(
    df["Poste"],
    df["DÃ©part"],
    normalize="index"
)

# On trie par taux de dÃ©part "Yes" si prÃ©sent
if "Yes" in table_h6.columns:
    table_h6 = table_h6.sort_values("Yes", ascending=False)

table_h6.head()
```

```{python}
fig, ax = plt.subplots(figsize=(10, 6))

bottom = np.zeros(len(table_h6))
x = np.arange(len(table_h6.index))

for status in table_h6.columns:
    ax.bar(x, table_h6[status].values, bottom=bottom, label=status)
    bottom += table_h6[status].values

ax.set_title("Taux de dÃ©part par poste (barres empilÃ©es)")
ax.set_xlabel("Poste")
ax.set_ylabel("Proportion d'employÃ©s")
ax.set_xticks(x)
ax.set_xticklabels(table_h6.index, rotation=45, ha="right")
ax.legend(title="DÃ©part")
ax.grid(axis="y", alpha=0.3)

fig_path_h6_bar = os.path.join(OUTPUT_DIR, "H6_poste_depart_barres.png")
fig.savefig(fig_path_h6_bar, dpi=300, bbox_inches="tight")
plt.show()
plt.close(fig)

print("âœ… Figure H6 (barres) sauvegardÃ©e :", fig_path_h6_bar)
```

```{python}
# Heatmap "maison" (sans seaborn)
heatmap_data = table_h6.copy()

fig, ax = plt.subplots(figsize=(10, 6))
im = ax.imshow(heatmap_data.values, aspect="auto")

ax.set_xticks(np.arange(len(heatmap_data.columns)))
ax.set_yticks(np.arange(len(heatmap_data.index)))
ax.set_xticklabels(heatmap_data.columns)
ax.set_yticklabels(heatmap_data.index)
plt.setp(ax.get_yticklabels(), rotation=45, ha="right")

ax.set_title("Taux de dÃ©part par poste (heatmap)")
ax.set_xlabel("DÃ©part")
ax.set_ylabel("Poste")

for i in range(heatmap_data.shape[0]):
    for j in range(heatmap_data.shape[1]):
        value = heatmap_data.values[i, j]
        ax.text(
            j, i, f"{value:.2f}",
            ha="center", va="center",
            color="white" if value > 0.5 else "black",
            fontsize=8
        )

fig.colorbar(im, ax=ax, fraction=0.046, pad=0.04)

fig_path_h6_hm = os.path.join(OUTPUT_DIR, "H6_poste_depart_heatmap.png")
fig.savefig(fig_path_h6_hm, dpi=300, bbox_inches="tight")
plt.show()
plt.close(fig)

print("âœ… Figure H6 (heatmap) sauvegardÃ©e :", fig_path_h6_hm)
```

## RÃ©capitulatif des figures gÃ©nÃ©rÃ©es

```{python}
files = sorted(f for f in os.listdir(OUTPUT_DIR) if f.lower().endswith(".png"))
files
```

---

## ğŸ”— Navigation du projet

- ğŸ“Š [Voir les RÃ©sultats de lâ€™Analyse Exploratoire (EDA)](eda_resultats.qmd)
- ğŸ“Œ [Voir la SynthÃ¨se & Recommandations RH](synthese_reco.qmd)
- ğŸ  [Retour Ã  la page dâ€™accueil du projet People Analytics](../index.qmd)

