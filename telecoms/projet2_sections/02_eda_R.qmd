---
title: "Exploration des données – QoS mobile 2024"
subtitle: "Voix & Internet mobile – France métropolitaine"
format:
  html:
    toc: true
    toc-depth: 3
    number-sections: true
    code-fold: false
execute:
  echo: false
  warning: false
  message: false
---

```{r setup, include=FALSE}
# Packages strictement nécessaires
library(readr)
library(dplyr)
library(ggplot2)

knitr::opts_chunk$set(
  echo    = FALSE,
  message = FALSE,
  warning = FALSE
)

# Fonction de nettoyage simple pour les noms de colonnes
clean_names_local <- function(df) {
  nms <- names(df)
  nms <- trimws(nms)
  nms <- tolower(nms)
  nms <- gsub("[^[:alnum:]]+", "_", nms)
  nms <- gsub("_+", "_", nms)
  nms <- gsub("^_|_$", "", nms)
  names(df) <- nms
  df
}

# Liste d'opérateurs, pour garder un ordre cohérent
operateurs_levels <- c("Orange", "SFR", "Bouygues", "Free")

standardiser_operateur <- function(df) {
  if (!"operator" %in% names(df)) return(df)
  df$operator <- as.character(df$operator)
  df$operator[df$operator == "Bouygues Telecom"] <- "Bouygues"
  df$operator <- factor(df$operator, levels = operateurs_levels)
  df
}

# IMPORTANT :
# 02_eda_R.qmd est dans "telecoms/projet2_sections"
# Le dossier "data" est à la racine du repo ("nancy-jennifer.github.io")
# → il faut remonter DEUX niveaux depuis le working dir :
#   telecoms/projet2_sections -> telecoms -> nancy-jennifer.github.io
base_dir <- "../.."
```

# 1. Contexte et questions d’analyse

Ce rapport explore la **qualité de service mobile 2024** en France métropolitaine, sur deux volets :

- **Voix** : capacité à établir des appels de manière fiable, sans coupure ni perturbation audible ;
- **Data** : confort d’usage internet (pages qui se chargent rapidement, débits suffisants).

Les mesures ARCEP proviennent de campagnes de mesures terrain.  
Les objectifs de l’EDA :

- identifier les **forces** et **faiblesses** de chaque opérateur en Voix et en Data ;
- repérer les **zones à risque** pour l’expérience client (habitations vs transports, types de zones) ;
- préparer des **messages clés** exploitables par un recruteur ou un décideur réseau.

# 2. Données et préparation

## 2.1 ARCEP France – Chargement des fichiers

```{r load-data-fr}
globaux_clean <- read_csv(
  file.path(base_dir, "data", "processed", "arcep_2024_indicateurs_globaux_clean.csv")
) |>
  clean_names_local()

voix_hab <- read_csv(
  file.path(base_dir, "data", "processed", "2024_QoS_Metropole_voix_habitations_clean.csv")
) |>
  clean_names_local() |>
  standardiser_operateur()

voix_trans <- read_csv(
  file.path(base_dir, "data", "processed", "2024_QoS_Metropole_voix_transports_clean.csv")
) |>
  clean_names_local() |>
  standardiser_operateur()

data_hab <- read_csv(
  file.path(base_dir, "data", "processed", "2024_QoS_Metropole_data_habitations_clean.csv")
) |>
  clean_names_local() |>
  standardiser_operateur()

data_trans <- read_csv(
  file.path(base_dir, "data", "processed", "2024_QoS_Metropole_data_transports_clean.csv.gz.zip")
) |>
  clean_names_local() |>
  standardiser_operateur()
```

## 2.2 Harmonisation des structures

```{r standardisation-operateurs}
# Concat Voix (habitations + transports)
voix_all <- bind_rows(
  voix_hab  |> mutate(context = "Habitations"),
  voix_trans |> mutate(context = "Transports")
)

if (!"zone" %in% names(voix_all)) {
  voix_all$zone <- "inconnue"
}
voix_all$zone <- factor(voix_all$zone)

# Concat Data (habitations + transports)
data_all <- bind_rows(
  data_hab  |> mutate(context = "Habitations"),
  data_trans |> mutate(context = "Transports")
)

if (!"zone" %in% names(data_all)) {
  data_all$zone <- "inconnue"
}
data_all$zone <- factor(data_all$zone)
```

---

# 3. Voix – fiabilité des appels

## 3.1 Score Voix 0–100 par opérateur

```{r voix-kpi}
# On suppose une variable binaire crspa (1 = appel réussi, 0 = échec)
voix_kpi_base <- voix_all |>
  filter(!is.na(crspa)) |>
  group_by(operator, zone, context) |>
  summarise(
    taux_appels_reussis = mean(crspa == 1, na.rm = TRUE),
    n                   = n(),
    .groups             = "drop"
  )

voix_kpi_rescale <- voix_kpi_base |>
  mutate(score_voix_100 = 100 * taux_appels_reussis)

kpi_voix_synthese_operateur <- voix_kpi_rescale |>
  group_by(operator) |>
  summarise(
    score_voix_moyen = weighted.mean(score_voix_100, w = n, na.rm = TRUE),
    n_total          = sum(n),
    .groups          = "drop"
  ) |>
  arrange(desc(score_voix_moyen))
```

```{r voix-kpi-table}
kpi_voix_synthese_operateur
```

Lecture métier (Voix – score global) :

- **Score sur 0–100**, pondéré par le volume de mesures ;
- Classement des opérateurs en **fiabilité d’établissement d’appel**.

```{r voix-kpi-plot, fig.cap="Score voix (0–100) par opérateur, zone et contexte (habitations vs transports)."}
ggplot(voix_kpi_rescale,
       aes(x = operator, y = score_voix_100, fill = operator)) +
  geom_col() +
  facet_grid(context ~ zone) +
  scale_y_continuous(limits = c(0, 100)) +
  labs(
    title    = "Voix – score d’appels réussis (0–100)",
    subtitle = "Lecture croisée opérateur × zone × contexte",
    x        = NULL,
    y        = "Score voix (0–100)"
  ) +
  guides(fill = "none")
```

## 3.2 Zones à risque Voix

```{r voix-zones-risque}
voix_anomalies <- voix_kpi_rescale |>
  filter(score_voix_100 < 95) |>
  arrange(score_voix_100)

voix_anomalies
```

Lecture métier :

- **< 90** : zones critiques à adresser en priorité (risque fort sur l’expérience client) ;
- **90–95** : zones sensibles, à intégrer dans un plan d’amélioration 6–12 mois.

```{r voix-zones-risque-plot, fig.cap="Voix – zones à risque (score < 95) par opérateur, zone et contexte."}
if (nrow(voix_anomalies) > 0) {
  ggplot(voix_anomalies,
         aes(x = operator, y = score_voix_100, fill = operator)) +
    geom_col() +
    facet_grid(context ~ zone) +
    scale_y_continuous(limits = c(0, 100)) +
    labs(
      title    = "Voix – zones à risque (scores < 95)",
      subtitle = "Par opérateur, zone et contexte",
      x        = NULL,
      y        = "Score voix (0–100)"
    ) +
    guides(fill = "none")
}
```

---

# 4. Data – confort d’usage internet mobile

## 4.1 KPI Data par opérateur

```{r data-kpi}
# On suppose :
# - loaded_in_less_10_secondes : indicateur binaire (1 = page chargée en < 10 s)
# - bitrate_dl : débit descendant en Mbit/s

data_kpi_prov_operateur <- data_all |>
  group_by(context, operator) |>
  summarise(
    part_pages_10s = mean(loaded_in_less_10_secondes == 1, na.rm = TRUE),
    debit_dl_med   = median(bitrate_dl, na.rm = TRUE),
    n              = n(),
    .groups        = "drop"
  ) |>
  mutate(part_pages_10s_100 = 100 * part_pages_10s)

data_kpi_prov_operateur
```

```{r data-kpi-plot, fig.cap="Internet mobile – part des pages chargées en moins de 10 s, par opérateur et contexte."}
ggplot(data_kpi_prov_operateur,
       aes(x = operator, y = part_pages_10s_100, fill = operator)) +
  geom_col() +
  facet_wrap(~ context) +
  scale_y_continuous(limits = c(0, 100)) +
  labs(
    title    = "Internet mobile – pages chargées en moins de 10 s",
    subtitle = "Par opérateur et par contexte",
    x        = NULL,
    y        = "Part des pages < 10 s (%)"
  ) +
  guides(fill = "none")
```

Lecture métier :

- **Part des pages < 10 s** : indicateur direct de **confort de navigation** ;
- **Débit descendant médian** : vision de la **capacité radio** disponible par opérateur.

## 4.2 Performance Data par zone (si disponible)

```{r data-zone-kpi}
if ("zone" %in% colnames(data_all)) {
  data_env_probe_map <- data_all |>
    group_by(context, operator, zone) |>
    summarise(
      part_pages_10s = mean(loaded_in_less_10_secondes == 1, na.rm = TRUE),
      debit_dl_med   = median(bitrate_dl, na.rm = TRUE),
      n              = n(),
      .groups        = "drop"
    ) |>
    mutate(part_pages_10s_100 = 100 * part_pages_10s)
} else {
  data_env_probe_map <- NULL
}

data_env_probe_map
```

```{r data-zone-plot, fig.cap="Internet mobile – performance par zone et opérateur (si variable zone disponible)."}
if (!is.null(data_env_probe_map) && nrow(data_env_probe_map) > 0) {
  ggplot(data_env_probe_map,
         aes(x = zone, y = part_pages_10s_100, colour = operator, group = operator)) +
    geom_line() +
    geom_point() +
    facet_wrap(~ context) +
    scale_y_continuous(limits = c(0, 100)) +
    labs(
      title    = "Internet mobile – performance par zone",
      subtitle = "Lecture par opérateur et par contexte",
      x        = "Zone",
      y        = "Part des pages < 10 s (%)"
    )
}
```

## 4.3 Micro-diagnostics ciblés

```{r data-micro}
data_micro_diag <- data_kpi_prov_operateur |>
  arrange(part_pages_10s_100) |>
  slice_head(n = 10)

data_micro_diag
```

Lecture métier :

- Top 10 des **combinaisons opérateur × contexte** les plus fragiles en Data ;
- Entrée directe pour un **plan d’action Data** (optimisation radio, capacité cœur de réseau, etc.).

---

# 5. Synthèse pour décideurs

Cette EDA met en évidence :

- en **Voix**, un score global élevé mais avec des **poches de risque** sur certains couples *opérateur × zone × contexte* ;
- en **Data**, des écarts plus marqués entre opérateurs, en particulier sur :
  - la **part des pages < 10 s**,
  - les zones où la performance se dégrade fortement.

Pour un recruteur ou un décideur réseau, ce rapport montre que tu es capable de :

- construire des **KPI robustes** (Voix 0–100, Data < 10 s, débits médians) ;
- identifier des **zones à risque** priorisables dans un plan d’action ;
- proposer une lecture orientée **qualité d’expérience client** et **priorisation opérationnelle**.

Les sections suivantes du projet (hors de ce fichier) pourront ensuite :

- détailler les **recommandations réseau** (plan 90 jours / 12 mois) ;
- ouvrir sur un **benchmark international** dans un autre document dédié, pour garder ce fichier stable et lisible.
