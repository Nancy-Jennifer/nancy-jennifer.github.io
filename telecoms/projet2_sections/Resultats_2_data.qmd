---
title: "Résultats – Data (Internet mobile)"
subtitle: "Médianes p50 – DL / UL / RSRP"
format:
  html:
    toc: true
    toc-depth: 3
    number-sections: false
    code-fold: show
execute:
  echo: true
  warning: false
  message: false
---

## Résultats DATA – p50 essentiels

```{r data-p50-setup, echo=FALSE, message=FALSE, warning=FALSE}
suppressPackageStartupMessages({
  library(dplyr); library(ggplot2); library(forcats)
})

# === on standardise les noms pour être robustes FR/EN ===
dsn <- data_scored_norm |>
  rename_with(~tolower(gsub("[^a-z0-9]+","_",.x)))

# mapping minimal des colonnes brutes
col_op   <- grep("operat|brand|provider", names(dsn), value=TRUE)[1]
col_dl   <- grep("download|descend|downlink|mbps.*down|dl", names(dsn), value=TRUE)[1]
col_ul   <- grep("upload|montant|uplink|mbps.*up|ul", names(dsn), value=TRUE)[1]
col_rsrp <- grep("\\brsrp\\b|rsrp_dbm|signal", names(dsn), value=TRUE)[1]

df <- dsn |>
  transmute(
    operateur = dsn[[col_op]] |> as.character() |> tolower() |> tools::toTitleCase(),
    dl = suppressWarnings(as.numeric(dsn[[col_dl]])),
    ul = suppressWarnings(as.numeric(dsn[[col_ul]])),
    rsrp = suppressWarnings(as.numeric(dsn[[col_rsrp]]))
  ) |>
  group_by(operateur) |>
  summarise(
    dl_p50 = median(dl, na.rm=TRUE),
    ul_p50 = median(ul, na.rm=TRUE),
    rsrp_p50 = median(rsrp, na.rm=TRUE),
    .groups="drop"
  )

# ordre UX = classer par DL p50 décroissant
df <- df |> mutate(operateur = fct_reorder(operateur, dl_p50, .desc=TRUE))
theme_set(theme_minimal(base_size=13))
```

### Débit descendant — p50
```{r data-p50-dl, fig.width=8, fig.height=4.4}
ggplot(df, aes(operateur, dl_p50)) +
  geom_col() +
  geom_text(aes(label=round(dl_p50,1)), vjust=-0.3, size=3.5) +
  labs(title="Débit descendant — médiane p50", y="Mb/s", x=NULL)
```

### Débit montant — p50
```{r data-p50-ul, fig.width=8, fig.height=4.4}
ggplot(df, aes(operateur, ul_p50)) +
  geom_col() +
  geom_text(aes(label=round(ul_p50,1)), vjust=-0.3, size=3.5) +
  labs(title="Débit montant — médiane p50", y="Mb/s", x=NULL)
```

### RSRP — p50
```{r data-p50-rsrp, fig.width=8, fig.height=4.4}
ggplot(df, aes(operateur, rsrp_p50)) +
  geom_col() +
  geom_hline(yintercept=-100, linetype="dashed") +
  geom_text(aes(label=round(rsrp_p50,0)), vjust=-0.3, size=3.5) +
  labs(title="RSRP — médiane p50", y="dBm (plus proche de 0 = meilleur)", x=NULL)
```
