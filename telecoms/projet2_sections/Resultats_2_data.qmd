
---
title: "Résultats – Data (Internet mobile)"
subtitle: "Pass 5s/10s pondérés & radio (RSRP/RSCP) — rendu exécutif, sans code visible"
format:
  html:
    toc: true
    toc-depth: 2
    number-sections: false
    code-fold: false
    df-print: paged
execute:
  echo: false
  warning: false
  message: false
---

```{r setup}
suppressPackageStartupMessages({
  library(dplyr); library(tidyr); library(ggplot2); library(forcats)
})

# -------- Sécurités & helpers --------
stopifnot(exists("data_scored_norm"))
df0 <- data_scored_norm %>%
  mutate(
    operateur = as.character(operateur),
    indicateur = as.character(indicateur),
    valeur = suppressWarnings(as.numeric(valeur)),
    base_val = suppressWarnings(as.numeric(base_val))
  )

wmean <- function(x, w){
  x <- as.numeric(x); w <- as.numeric(w)
  if (!length(x)) return(NA_real_)
  if (all(is.na(w))) return(mean(x, na.rm = TRUE))
  stats::weighted.mean(x, w, na.rm = TRUE)
}

pal <- c("#249EA0","#8E62C9","#D36A5C","#6AA84F")  # sobre
theme_set(theme_minimal(base_size = 13))
```

# Préparation (rappel)

Les indicateurs exploités : **pass < 5 s**, **pass < 10 s** (pondérés par *base_val*) et **RSRP/RSCP** (médianes & IQR, dBm : plus proche de 0 = meilleur).  
Les résultats sont consolidés **par opérateur**, tous environnements confondus.

::: {.callout-tip}
**Lecture métier.**  
- *Pass < 5 s* : expérience instantanée perçue.  
- *Pass < 10 s* : robustesse générale de chargement.  
- *RSRP/RSCP* : qualité radio sous-jacente ; cible usuelle : médiane ≥ −100 dBm & IQR serré.
:::

```{r kpi-data}
# --- KPI "pass < 5 s" pondéré ---
pass5 <- df0 %>%
  filter(indicateur == "loaded_in_less_5_secondes", is.finite(valeur)) %>%
  group_by(operateur) %>%
  summarise(pass_5s = 100*wmean(valeur, base_val), n = sum(!is.na(valeur)), .groups="drop") %>%
  mutate(operateur = fct_reorder(operateur, pass_5s, .desc = TRUE))

# --- KPI "pass < 10 s" pondéré ---
pass10 <- df0 %>%
  filter(indicateur == "loaded_in_less_10_secondes", is.finite(valeur)) %>%
  group_by(operateur) %>%
  summarise(pass_10s = 100*wmean(valeur, base_val), n = sum(!is.na(valeur)), .groups="drop") %>%
  mutate(operateur = fct_reorder(operateur, pass_10s, .desc = TRUE))

# --- Radio : médiane & IQR (RSRP & RSCP) ---
radio <- df0 %>%
  filter(indicateur %in% c("rsrp","rscp"), is.finite(valeur)) %>%
  group_by(operateur, indicateur) %>%
  summarise(
    med = median(valeur, na.rm = TRUE),
    p25 = quantile(valeur, .25, na.rm = TRUE, names = FALSE),
    p75 = quantile(valeur, .75, na.rm = TRUE, names = FALSE),
    .groups="drop"
  ) %>%
  mutate(indicateur = factor(indicateur, levels = c("rsrp","rscp")))
```

## Pass rate < 5 secondes (pondéré)

Une latence initiale maîtrisée (< 5 s) traduit une **expérience instantanée** satisfaisante dans les contextes les plus exigeants (pics de charge, nœuds de trafic).

```{r fig-pass5, fig.width=8, fig.height=4.5}
if (nrow(pass5)){
  ggplot(pass5, aes(operateur, pass_5s)) +
    geom_col(fill = pal[1]) +
    geom_text(aes(label = sprintf("%.1f%%", pass_5s)), vjust = -0.35, size = 3.5) +
    coord_cartesian(ylim = c(0, 105)) +
    labs(y = "% de succès (<5 s)", x = NULL, title = "Pass < 5 s (pondéré par base_val)") +
    theme(axis.text.x = element_text(face = "bold"))
}
```

::: {.callout-note}
**Lecture métier.** Le *pass < 5 s* reflète l’instantané client : un écart > 5 pts devient perceptible.  
**Action.** Sécuriser les 5 s en zones denses (gares, carrefours, centres commerciaux).
:::

## Pass rate < 10 secondes (pondéré)

À 10 s, la plupart des contenus **finissent par charger** ; les écarts résiduels signalent des **goulots de capacité/couverture**.

```{r fig-pass10, fig.width=8, fig.height=4.5}
if (nrow(pass10)){
  ggplot(pass10, aes(operateur, pass_10s)) +
    geom_col(fill = pal[2]) +
    geom_text(aes(label = sprintf("%.1f%%", pass_10s)), vjust = -0.35, size = 3.5) +
    coord_cartesian(ylim = c(0, 105)) +
    labs(y = "% de succès (<10 s)", x = NULL, title = "Pass < 10 s (pondéré par base_val)") +
    theme(axis.text.x = element_text(face = "bold"))
}
```

::: {.callout-note}
**Cible.** ≥ 90 % sur les axes à fort trafic (ferroviaire/routier) avec pilotage sur **heures pleines**.
:::

## Qualité radio — Médiane & IQR (RSRP / RSCP)

Un plan radio solide soutient la QoE data : viser **médiane ≥ −100 dBm** et **IQR serré** (dispersion faible).

```{r fig-radio, fig.width=9, fig.height=4.8}
if (nrow(radio)){
  ggplot(radio, aes(operateur, med, ymin = p25, ymax = p75, colour = indicateur)) +
    geom_pointrange(position = position_dodge(width = 0.5), size = 0.7) +
    geom_hline(yintercept = -100, linetype = "dashed") +
    scale_colour_manual(values = c("rsrp" = pal[3], "rscp" = pal[4]), name = "Indicateur") +
    labs(y = "dBm (plus proche de 0 = meilleur)", x = NULL,
         title = "RSRP/RSCP — médiane (point) & IQR [p25–p75]") +
    theme(legend.position = "top",
          axis.text.x = element_text(face = "bold"))
}
```

::: {.callout-note}
**Actions.** Réduire les queues < −110 dBm sur les couloirs ferroviaires via **petites cellules / réglages paramétriques**.
:::

## Tableau récapitulatif (métriques clés)

```{r recap-table}
recap <- list(
  pass5  = pass5 %>% transmute(operateur, indicateur = "pass < 5 s",  valeur = sprintf("%.1f %%", pass_5s)),
  pass10 = pass10 %>% transmute(operateur, indicateur = "pass < 10 s", valeur = sprintf("%.1f %%", pass_10s)),
  rsrp   = radio  %>% filter(indicateur=="rsrp") %>%
            transmute(operateur, indicateur = "RSRP médiane [IQR]",
                      valeur = sprintf("%.0f dBm [%0.f;%0.f]", med, p25, p75)),
  rscp   = radio  %>% filter(indicateur=="rscp") %>%
            transmute(operateur, indicateur = "RSCP médiane [IQR]",
                      valeur = sprintf("%.0f dBm [%0.f;%0.f]", med, p25, p75))
) %>% bind_rows() %>% arrange(indicateur, desc(operateur))

if (nrow(recap)) knitr::kable(recap, align = "l l r", col.names = c("Opérateur","Indicateur","Valeur"))
```

## Synthèse analytique & recommandations

- **Expérience immédiate (5 s)** : viser **85–90 %** en zones denses ; traiter les poches sous-seuil via **dimensionnement PRB/layering** & **optim radio**.  
- **Robustesse (10 s)** : au-delà de 90 %, les irritants restants sont **localisés** ; plan d’actions ciblé par **corridors** (TGV/RER/autoroutes).  
- **Radio** : sécuriser une **médiane ≥ −100 dBm** et **resserrer l’IQR** ; chasse aux < −110 dBm avec boucle **mesure → optimisation → re-mesure**.

::: {.callout-tip}
**Conclusion.** Performances élevées mais **variabilité par contexte** (mobilité vs habitat).  
Un pilotage mensuel des **pass-rates pondérés** et des **médianes radio** aligne QoE et investissements.
:::

